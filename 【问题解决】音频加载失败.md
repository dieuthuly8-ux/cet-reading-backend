# 🔧 音频加载失败问题解决方案

---

## ❌ 问题描述

```
音频加载失败，请检查音频路径或网络后重试。
```

---

## 🔍 问题原因分析

### 原因1：缺少音频路径配置（已修复 ✅）

**问题**：
- 在生成听力题目时，只生成了题目数据
- 忘记为每个Section添加`audio`字段
- 前端无法找到音频文件路径

**症状**：
```json
{
  "sections": [
    {
      "name": "Section A",
      "questions": [...],
      // ❌ 缺少 "audio" 字段
    }
  ]
}
```

**解决方案**：
✅ 已运行 `fix-audio-paths.js` 修复
✅ 所有Section都已添加音频路径

**修复后**：
```json
{
  "sections": [
    {
      "name": "Section A",
      "audio": "assets/audio/cet6-listening/cet6-2024-12-set1.mp3",
      "questions": [...]
    }
  ]
}
```

---

### 原因2：四级音频文件不存在（需要导入）

**问题**：
- 只导入了六级听力音频（27个）
- 四级听力音频还未导入
- `cet4-2024-12-set1` 的音频文件不存在

**当前状态**：
```
assets/audio/
├── cet6-listening/          ✅ 已存在（27个MP3）
│   ├── cet6-2024-12-set1.mp3
│   ├── cet6-2024-12-set2.mp3
│   └── ...
└── cet4-listening/          ❌ 不存在
    └── (没有文件)
```

**解决方案**：

#### 方案A：导入四级听力音频（推荐）

1. **准备四级音频文件**
   - 将四级听力MP3放入 `四级听力` 文件夹
   - 文件命名格式：`YYYY年MM月...四级...第N套.mp3`

2. **运行导入脚本**
   ```bash
   node import-cet4-listening.js
   ```

3. **自动完成**
   - 创建 `assets/audio/cet4-listening/` 目录
   - 复制音频文件
   - 标准化命名

#### 方案B：暂时使用示例音频

如果暂时没有四级音频：

```javascript
// 修改 listening.json 中的四级音频路径
{
  "cet4-2024-12-set1": {
    "modes": {
      "exam": {
        "sections": [
          {
            "audio": "https://example.com/demo.mp3" // 使用在线示例
          }
        ]
      }
    }
  }
}
```

---

### 原因3：相对路径问题

**问题**：
- HTML文件位置不同，导致相对路径错误
- 音频路径是相对于HTML文件的

**诊断**：
```
如果从 index.html 访问：
✅ assets/audio/... 正确

如果从子目录访问（如 pages/listening.html）：
❌ assets/audio/... 错误
✅ ../assets/audio/... 正确
```

**解决方案**：
使用绝对路径或正确的相对路径

---

### 原因4：文件权限或路径问题

**可能原因**：
- 文件路径包含中文或特殊字符
- 文件权限不足
- 文件名大小写不匹配（Linux系统）

**检查方法**：
```bash
# 检查文件是否存在
ls assets/audio/cet6-listening/

# 检查文件权限
ls -l assets/audio/cet6-listening/cet6-2024-12-set1.mp3
```

---

## ✅ 当前修复状态

### 已完成
- ✅ 所有28套听力的音频路径已配置
- ✅ 六级27个音频文件已导入
- ✅ 路径格式统一：`assets/audio/cet6-listening/[examId].mp3`

### 待完成
- ⏳ 四级音频需要导入（如果有的话）

---

## 🔧 完整解决步骤

### 第1步：验证六级音频

打开网站，测试六级听力：

1. 访问 `listening-micro.html`
2. 选择六级听力（如 2024年12月第1套）
3. 点击播放

**预期结果**：
- ✅ 音频正常播放
- ✅ 进度条正常显示
- ✅ 可以暂停/播放

### 第2步：处理四级音频（可选）

如果需要使用四级听力：

#### 选项A：导入四级音频

```bash
# 1. 准备文件
# 将四级音频MP3放入"四级听力"文件夹

# 2. 创建导入脚本（类似六级）
node import-cet4-listening.js

# 3. 验证
ls assets/audio/cet4-listening/
```

#### 选项B：删除四级示例

如果不需要四级：

```javascript
// 从 listening.json 中删除
delete listeningData['cet4-2024-12-set1'];
```

---

## 📊 验证方法

### 方法1：浏览器开发者工具

1. 打开浏览器（F12）
2. 切换到 Console 标签
3. 查看错误信息

**常见错误**：
```
❌ 404 Not Found: assets/audio/cet6-listening/cet6-2024-12-set1.mp3
   → 文件不存在

❌ Failed to load resource
   → 路径错误或权限问题

❌ CORS policy
   → 需要本地服务器运行
```

### 方法2：直接访问音频

在浏览器地址栏输入：
```
http://localhost:8080/assets/audio/cet6-listening/cet6-2024-12-set1.mp3
```

**预期结果**：
- ✅ 音频开始播放或下载
- ❌ 404错误 → 文件不存在

### 方法3：检查文件结构

```bash
# 运行此命令
ls -R assets/audio/
```

**预期输出**：
```
assets/audio/:
cet6-listening/

assets/audio/cet6-listening/:
cet6-2019-06-set1.mp3
cet6-2019-06-set2.mp3
...
cet6-2025-06-set2.mp3
```

---

## 🚀 快速测试

### 测试脚本

创建 `test-audio.html` 测试单个音频：

```html
<!DOCTYPE html>
<html>
<head>
  <title>音频测试</title>
</head>
<body>
  <h1>音频路径测试</h1>
  
  <audio id="testAudio" controls>
    <source src="assets/audio/cet6-listening/cet6-2024-12-set1.mp3" type="audio/mpeg">
    您的浏览器不支持音频播放。
  </audio>
  
  <script>
    const audio = document.getElementById('testAudio');
    
    audio.addEventListener('loadeddata', () => {
      console.log('✅ 音频加载成功');
      console.log('时长:', audio.duration, '秒');
    });
    
    audio.addEventListener('error', (e) => {
      console.error('❌ 音频加载失败:', e);
      console.error('路径:', audio.src);
    });
  </script>
</body>
</html>
```

---

## 💡 预防措施

### 1. 使用绝对路径（推荐）

```javascript
// 不推荐：相对路径
"audio": "assets/audio/file.mp3"

// 推荐：绝对路径
"audio": "/assets/audio/file.mp3"
```

### 2. 音频文件命名规范

- ✅ 使用英文和数字
- ✅ 使用短横线连接
- ❌ 避免中文
- ❌ 避免空格和特殊字符

**正确示例**：
```
cet6-2024-12-set1.mp3
listening-section-a.mp3
```

**错误示例**：
```
2024年12月六级.mp3  ❌ 包含中文
listening section.mp3  ❌ 包含空格
```

### 3. 使用本地服务器

不要直接双击HTML文件，使用HTTP服务器：

```bash
# 方法1：使用Python
python -m http.server 8080

# 方法2：使用Node.js
npx http-server -p 8080

# 方法3：使用VS Code插件
# 安装 "Live Server" 插件
```

### 4. 定期检查

```bash
# 检查音频文件
find assets/audio -name "*.mp3" | wc -l

# 应该显示 27（六级）
```

---

## 📝 总结

### 问题根源
1. ❌ Section没有audio字段 → ✅ 已修复
2. ⏳ 四级音频未导入 → 需要导入（如果有）
3. ⚠️ 可能的路径问题 → 需要验证

### 当前状态
- ✅ 六级27套听力音频正常
- ✅ 音频路径已配置
- ⏳ 四级听力需要导入音频

### 下一步
1. **立即测试六级听力** - 应该可以正常播放
2. **如果需要四级** - 导入四级音频
3. **如果不需要四级** - 从系统中移除

---

## 🎯 现在就测试

打开 `listening-micro.html`，选择任意六级听力，点击播放！

**应该可以正常播放了！** 🎧✨

---

*问题排查完成时间: 2025年11月15日 21:52*  
*修复状态: 六级音频路径已修复 ✅*  
*待处理: 四级音频需要导入 ⏳*
