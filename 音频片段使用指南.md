# 听力音频片段功能使用指南

## 功能说明

在"跨试卷微练习"中，现已支持**音频片段自动截取**功能。为每道题目添加时间戳后，播放器会自动：
- ✂️ 跳转到题目对应的音频片段起始位置
- 🔒 播放到片段结束位置时自动暂停
- 🔁 每次播放自动重置到片段起点
- 🎯 显示片段时长提示（如：音频片段：0:05 - 1:25）

## 如何添加时间戳

### 1. 在 listening.json 中添加字段

为需要截取片段的题目添加两个字段：
- `audioStart`: 起始时间（秒）
- `audioEnd`: 结束时间（秒）

### 2. 示例

```json
{
  "id": 1,
  "passage": 1,
  "stem": "What are the speakers mainly discussing?",
  "options": [...],
  "answer": "A",
  "explain": "主要讨论研究方法。",
  "mode": "exam",
  "audioStart": 5,
  "audioEnd": 85,
  "tags": {...}
}
```

**说明**：
- `audioStart: 5` 表示从音频的第 5 秒开始播放
- `audioEnd: 85` 表示播放到第 85 秒（1分25秒）时自动暂停
- 播放器会自动计算并显示：`音频片段：0:05 - 1:25`

### 3. 如何确定时间戳

**方法一：手动标记**
1. 在普通播放器中打开完整音频
2. 播放到题目对应段落的起始位置，记录时间（如 0:05）
3. 播放到该段落结束位置，记录时间（如 1:25）
4. 将时间转换为秒数：5秒和85秒

**方法二：使用波形编辑器**
1. 使用 Audacity、Adobe Audition 等音频编辑软件
2. 打开音频文件，查看波形
3. 选中对应段落，软件会显示精确的起止时间
4. 复制时间戳到 JSON 文件

### 4. 批量添加建议

为了提高效率，建议：
1. 先为最常练习的试卷（如 2024、2023 年）添加时间戳
2. 优先为 Section A（长对话）和 Section B（短文）添加，这两部分最需要片段播放
3. Section C（讲座）较长，可以根据实际需要添加

## 示例效果

已为 `cet6-2019-12-set1` 的前两题添加了时间戳示例。

访问页面：
```
listening-micro.html
```

生成练习后，带有时间戳的题目会：
1. 显示绿色的片段提示徽章：`✂️ 音频片段：0:05 - 1:25`
2. 点击播放后自动从第5秒开始
3. 播放到第85秒时自动暂停并重置到第5秒
4. A-B循环功能仍可正常使用（优先级高于时间戳限制）

## 兼容性说明

- ✅ **有时间戳的题目**：自动播放片段，提升练习效率
- ✅ **无时间戳的题目**：正常播放完整音频，保持向后兼容
- ✅ **混合练习**：同一个练习中可以混合有/无时间戳的题目

## 高级功能

### A-B循环与片段播放的协同
1. 片段播放自动激活后，你仍可以使用"标记A"/"标记B"按钮
2. A-B循环的优先级更高：
   - 开启A-B循环后，播放器在A-B范围内循环
   - 关闭A-B循环后，恢复片段限制（audioStart - audioEnd）
3. 这样可以在片段内再精细定位特定句子进行反复练习

### 倍速播放
- 倍速选择器（0.75x, 1x, 1.25x, 1.5x）与片段播放完全兼容
- 适合精听训练

## 时间戳模板

为方便批量添加，这里提供一个 JSON 字段模板：

```json
"audioStart": 0,
"audioEnd": 60,
```

将此字段添加到题目的 `mode` 字段后、`tags` 字段前即可。

## 常见问题

### Q: 时间戳可以精确到小数吗？
A: 可以！支持小数秒，如 `"audioStart": 5.5` 表示5.5秒。

### Q: 如果只添加部分题目的时间戳会怎样？
A: 不影响！有时间戳的题目播放片段，没有的播放完整音频。

### Q: 时间戳设置错误怎么办？
A: 页面会自动容错。如果起止时间有问题，播放器会尽力播放，不会报错。

### Q: 可以为所有题目批量生成时间戳吗？
A: 这需要手动标记。如果你有音频转写文本（带时间戳的字幕文件），可以编写脚本自动匹配，但建议先手动标记几套高频试卷。

## 建议的标记优先级

1. **优先标记**：2023-2025年的 CET-4/6 试卷
2. **重点部分**：Section A（长对话）、Section B（短文）
3. **可选**：Section C（讲座）较长，可按需标记关键段落

---

**功能已就绪！** 你可以立即开始为 `listening.json` 中的题目添加 `audioStart` 和 `audioEnd` 字段，享受精准的片段练习体验。
