# 七牛云对象存储配置完整指南

## 📋 方案说明

**组合方案：Vercel + 七牛云**

- **网站托管：** Vercel（免费）
- **大文件存储：** 七牛云对象存储（免费10GB）
- **CDN加速：** 七牛云CDN（免费10GB流量/月）

**总成本：¥0/年**（在免费额度内）

**优势：国内访问速度最快！** 🚀

---

## 🎯 免费额度说明

### 七牛云免费额度（实名认证后）

```
✅ 对象存储：10GB
✅ CDN流量：10GB/月
✅ PUT/DELETE请求：10万次/月
✅ GET请求：100万次/月
```

**你的项目需求：**
- 存储：约6.5GB ✅ 够用
- 流量：学生项目通常<10GB/月 ✅ 够用

**超出后费用：**
- 存储：¥0.148/GB/月
- 流量：¥0.29/GB

---

## 📝 阶段一：注册七牛云账号

### 第1步：注册账号

1. **访问：** https://www.qiniu.com/
2. **点击：** 右上角"注册"
3. **填写信息：**
   - 手机号
   - 验证码
   - 密码

### 第2步：实名认证（获取免费额度）

1. **登录后点击：** 右上角头像 → "实名认证"
2. **选择：** "个人认证"
3. **填写资料：**
   - 姓名
   - 身份证号
   - 上传身份证照片（正反面）
4. **提交审核**（通常5分钟内完成）

### 第3步：激活对象存储

1. **进入控制台：** https://portal.qiniu.com/
2. **点击：** "对象存储 Kodo"
3. **阅读并同意服务协议**

---

## 🗂️ 阶段二：创建存储空间

### 第1步：新建存储空间（Bucket）

1. **进入对象存储：** https://portal.qiniu.com/kodo/bucket
2. **点击：** "新建空间"
3. **填写配置：**

```
空间名称：     cet-learning-files
（只能包含字母、数字、-、_，且长度3-63字符）

存储区域：     华东-浙江
（选择离你用户最近的区域，学生项目选华东即可）

访问控制：     公开空间
（允许外部直接访问文件）

```

4. **点击：** "确定创建"

### 第2步：配置CDN加速域名

**七牛云会自动分配一个测试域名，但只能用30天。**

#### 选项A：使用测试域名（临时，30天）

1. **进入空间详情**
2. **查看 "域名管理"**
3. **复制测试域名：**
   ```
   示例：http://xxx.clouddn.com
   ```

#### 选项B：绑定自己的域名（长期使用）

**如果你有域名：**

1. **点击：** "域名管理" → "添加域名"
2. **填写：**
   - 加速域名：`cdn.你的域名.com`
   - 通信协议：HTTP
   - 源站配置：默认
3. **DNS解析：**
   - 到你的域名DNS服务商
   - 添加CNAME记录指向七牛提供的地址

**没有域名？**
- 使用测试域名先跑起来
- 或者在阿里云/腾讯云买个域名（¥10-30/年）

---

## 📤 阶段三：上传文件

### 方法1：网页上传（适合少量文件）

1. **进入空间 `cet-learning-files`**
2. **点击：** "文件管理" → "上传文件"
3. **选择文件并上传**

**优点：** 简单直观
**缺点：** 一次只能上传几个文件，慢

### 方法2：使用七牛云工具上传（推荐）

#### 下载qshell工具

1. **访问：** https://developer.qiniu.com/kodo/1302/qshell
2. **下载Windows版本：** `qshell-windows-x64.exe`
3. **重命名为：** `qshell.exe`
4. **放到：** `E:\cursor\作业\tools\` 文件夹

#### 配置qshell

**打开PowerShell，执行：**

```powershell
# 进入工具目录
cd E:\cursor\作业\tools

# 添加账号（需要AK和SK）
.\qshell.exe account add qiniu-cet <你的AK> <你的SK> <你的名字>
```

#### 获取AK和SK（密钥）

1. **访问：** https://portal.qiniu.com/user/key
2. **查看并复制：**
   - AccessKey (AK)
   - SecretKey (SK)

**示例命令：**
```powershell
.\qshell.exe account add qiniu-cet YOUR_ACCESS_KEY YOUR_SECRET_KEY
```

#### 批量上传文件

**创建上传配置文件 `upload-config.json`：**

```json
{
  "src_dir": "E:\\cursor\\作业\\四级听力",
  "bucket": "cet-learning-files",
  "key_prefix": "audio/cet4/",
  "overwrite": true,
  "check_exists": true,
  "ignore_dir": false,
  "up_host": "https://up-z0.qiniup.com",
  "rescan_local": true
}
```

**执行上传：**
```powershell
.\qshell.exe qupload upload-config.json
```

**上传所有文件夹：**

```powershell
# 四级听力
.\qshell.exe qupload upload-cet4-audio.json

# 六级听力
.\qshell.exe qupload upload-cet6-audio.json

# 四级PDF
.\qshell.exe qupload upload-cet4-pdf.json

# 六级PDF
.\qshell.exe qupload upload-cet6-pdf.json
```

### 方法3：使用图形界面工具（最简单）

#### 下载Kodo Browser

1. **访问：** https://github.com/qiniu/kodo-browser/releases
2. **下载Windows版本**
3. **安装并运行**
4. **登录：** 输入AK和SK
5. **拖拽上传文件**

**这是最简单的方式！** 推荐使用。

---

## 🔗 阶段四：获取文件CDN链接

### 链接格式

**基础格式：**
```
http://你的CDN域名/文件路径
```

**示例：**
```
http://xxx.clouddn.com/audio/cet4/cet4-2023-12-set1.mp3
```

### 文件组织结构

**建议按以下结构上传：**

```
cet-learning-files/
├── audio/
│   ├── cet4/
│   │   ├── cet4-2018-06-set1.mp3
│   │   ├── cet4-2018-06-set2.mp3
│   │   └── ...
│   └── cet6/
│       ├── cet6-2019-06-set1.mp3
│       └── ...
└── papers/
    ├── cet4/
    │   ├── 2018-06-set1.pdf
    │   └── ...
    └── cet6/
        └── ...
```

### 获取链接的方法

#### 方法1：在控制台查看

1. 进入空间 → 文件管理
2. 点击文件名
3. 复制"外链"地址

#### 方法2：手动拼接

```
CDN域名 + / + 文件路径
```

**示例：**
```javascript
const CDN_DOMAIN = 'http://xxx.clouddn.com';

// 音频链接
const audioUrl = `${CDN_DOMAIN}/audio/cet4/cet4-2023-12-set1.mp3`;

// PDF链接
const pdfUrl = `${CDN_DOMAIN}/papers/cet4/2023-12-set1.pdf`;
```

---

## 🔧 阶段五：修改网站代码

### 创建CDN配置文件

**创建 `qiniu-cdn-config.js`：**

```javascript
// 七牛云CDN配置
const QINIU_CDN = {
  // 替换为你的CDN域名
  domain: 'http://你的域名.clouddn.com',
  
  // 音频文件路径
  audio: {
    cet4: (filename) => `${QINIU_CDN.domain}/audio/cet4/${filename}`,
    cet6: (filename) => `${QINIU_CDN.domain}/audio/cet6/${filename}`,
  },
  
  // PDF文件路径
  papers: {
    cet4: (filename) => `${QINIU_CDN.domain}/papers/cet4/${filename}`,
    cet6: (filename) => `${QINIU_CDN.domain}/papers/cet6/${filename}`,
  }
};

// 使用示例
// const audioUrl = QINIU_CDN.audio.cet4('cet4-2023-12-set1.mp3');
// const pdfUrl = QINIU_CDN.papers.cet4('2023-12-set1.pdf');

export default QINIU_CDN;
```

### 修改listening.json（听力数据）

**如果你有 `listening.json` 文件：**

```json
{
  "cet4": [
    {
      "year": "2023",
      "month": "12",
      "set": 1,
      "audioUrl": "http://你的域名.clouddn.com/audio/cet4/cet4-2023-12-set1.mp3"
    }
  ]
}
```

### 修改真题页面（PDF下载）

**找到PDF下载链接的地方：**

```html
<!-- 修改前 -->
<a href="英语四级/2023年12月.pdf" download>下载真题</a>

<!-- 修改后 -->
<a href="http://你的域名.clouddn.com/papers/cet4/2023-12-set1.pdf" download>下载真题</a>
```

### 使用JavaScript动态生成链接

```javascript
// 引入配置
import QINIU_CDN from './qiniu-cdn-config.js';

// 动态设置音频
document.getElementById('audio').src = QINIU_CDN.audio.cet4('cet4-2023-12-set1.mp3');

// 动态设置下载链接
document.getElementById('download-btn').href = QINIU_CDN.papers.cet4('2023-12-set1.pdf');
```

---

## 📊 性能优化

### 1. 启用HTTPS（推荐）

**如果你有自己的域名：**

1. 在七牛云申请免费SSL证书
2. 在域名管理中启用HTTPS
3. 修改链接为 `https://`

### 2. 图片压缩（如果有图片）

**七牛云自动图片处理：**

```javascript
// 原图
const imageUrl = 'http://xxx.clouddn.com/image.jpg';

// 压缩后（宽度800px）
const compressedUrl = `${imageUrl}?imageView2/2/w/800`;
```

### 3. 设置缓存

**在七牛云控制台：**
- 进入域名管理
- 设置缓存规则
- 建议：音频和PDF缓存7天

---

## 💰 成本监控

### 查看用量

1. **访问：** https://portal.qiniu.com/financial/overview
2. **查看：**
   - 存储用量
   - CDN流量
   - 请求次数

### 设置预警

1. **进入：** 财务中心 → 余额预警
2. **设置：** 余额低于¥10时提醒
3. **绑定手机号**接收通知

### 如果超出免费额度

**策略1：升级套餐**
- 购买存储包：¥9/月起

**策略2：清理旧文件**
- 删除不常用的文件
- 只保留最新年份的资料

**策略3：压缩文件**
- 音频降低码率
- PDF压缩大小

---

## 🎯 完整工作流程

### 日常更新流程

**当你添加新的真题时：**

1. **上传文件到七牛云**
   ```
   使用Kodo Browser拖拽上传
   ```

2. **获取CDN链接**
   ```
   http://你的域名.clouddn.com/audio/cet4/新文件.mp3
   ```

3. **更新网站代码**
   ```javascript
   // 在listening.json中添加新条目
   ```

4. **推送到GitHub**
   ```bash
   git add .
   git commit -m "添加2025年6月真题"
   git push
   ```

5. **Vercel自动部署**
   ```
   等待1-2分钟，网站自动更新
   ```

---

## 🔧 故障排查

### 问题1：文件上传失败

**可能原因：**
- AK/SK错误
- 空间名称错误
- 网络问题

**解决方法：**
1. 检查密钥是否正确
2. 确认空间名称
3. 重试上传

### 问题2：CDN链接打不开

**可能原因：**
- 域名未配置
- 文件未公开
- 路径错误

**解决方法：**
1. 检查空间是否设置为"公开"
2. 确认文件路径正确
3. 在浏览器直接访问测试

### 问题3：访问速度慢

**解决方法：**
1. 检查是否启用了CDN
2. 确认域名配置正确
3. 尝试更换存储区域

---

## 📞 技术支持

### 七牛云官方文档

- **对象存储文档：** https://developer.qiniu.com/kodo
- **CDN文档：** https://developer.qiniu.com/fusion
- **工具下载：** https://developer.qiniu.com/kodo/tools

### 工单支持

- **访问：** https://support.qiniu.com/
- **提交工单** 获取技术支持
- 响应时间：1-2个工作日

---

## ✅ 部署完成检查清单

**在开始使用前，确认：**

- [ ] 七牛云账号已实名认证
- [ ] 创建了存储空间
- [ ] 配置了CDN域名
- [ ] 上传了所有文件
- [ ] 测试了CDN链接可访问
- [ ] 修改了网站代码
- [ ] 推送到GitHub
- [ ] Vercel自动部署成功
- [ ] 网站所有功能正常

---

## 🎉 最终效果

**完成后你将拥有：**

```
✅ 网站：https://你的项目.vercel.app
✅ 音频：通过七牛云CDN快速加载
✅ PDF：一键下载，国内速度最快
✅ 成本：¥0（在免费额度内）
✅ 速度：国内访问极快
✅ 稳定：企业级CDN服务
```

---

## 🚀 开始行动

### 第1步：部署Vercel（现在）
```
双击：一键部署到Vercel.bat
```

### 第2步：注册七牛云（5分钟）
```
访问：https://www.qiniu.com/
注册并实名认证
```

### 第3步：配置存储（10分钟）
```
创建空间
配置域名
```

### 第4步：上传文件（15分钟）
```
下载Kodo Browser
拖拽上传所有文件
```

### 第5步：更新代码（5分钟）
```
修改CDN链接
推送到GitHub
```

---

**准备好了吗？开始部署吧！** 🎉
